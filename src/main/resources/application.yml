# ============================================
# Server Configuration (For Nginx HTTPS)
# ============================================
server:
  forward-headers-strategy: native
  server:
    servlet:
      session:
        tracking-modes: none

spring:
  application:
    name: catchup

  # ============================================
  # Security - OAuth2
  # ============================================
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_OAUTH_CLIENT_ID}
            client-secret: ${GOOGLE_OAUTH_CLIENT_SECRET}
            scope:
              - email
              - profile
  # ============================================
  # Database - PostgreSQL
  # ============================================
  datasource:
    driver-class-name: org.postgresql.Driver
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/catchup}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}

  jpa:
    hibernate:
      ddl-auto: ${JPA_HIBERNATE_DDL_AUTO:create-drop}
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    show-sql: false
    properties:
      hibernate:
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  # ============================================
  # Redis
  # ============================================
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0

  # ============================================
  # RabbitMQ
  # ============================================
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:guest}
    password: ${RABBITMQ_PASSWORD:guest}

# ============================================
# Logging
# ============================================
logging:
  level:
    org.hibernate.SQL: off
    org.hibernate.type.descriptor.sql.BasicBinder: trace
    com.team.catchup: DEBUG
    org.springframework.security: DEBUG

# ============================================
# JWT Authentication
# ============================================
jwt:
  secret: ${JWT_SECRET}
  access_expiration: ${JWT_ACCESS_EXPIRATION:3600000} # 1시간
  refresh_expiration: ${JWT_REFRESH_EXPIRATION:604800000} # 7일
  cookie:
    secure: ${JWT_COOKIE_SECURE}
    domain: ${JWT_COOKIE_DOMAIN}
    same-site: ${JWT_COOKIE_SAMESITE:Lax}

# ============================================
# MeiliSearch
# ============================================
meilisearch:
  url: ${MEILISEARCH_URL:http://localhost:7700}
  api-key: ${MEILISEARCH_API_KEY:masterKey}

# ============================================
# Jira Integration
# ============================================
jira:
  base-url: ${JIRA_BASE_URL}
  email: ${JIRA_USER_EMAIL}
  api-token: ${JIRA_API_TOKEN}

  connection:
    max-connections: 100
    pending-acquire-timeout: 45000
  timeout:
    connect: 10000
    response: 60000
    read: 60000
    write: 60000
  memory:
    max-in-memory-size: 2097152

# ============================================
# Notion Integration
# ============================================
notion:
  base-url: https://api.notion.com
  api-key: ${NOTION_API_KEY}
  version: ${NOTION_VERSION:2022-06-28}

  connection:
    max-connections: 100
    pending-acquire-timeout: 45000
  timeout:
    connect: 10000
    response: 60000
    read: 60000
    write: 60000
  memory:
    max-in-memory-size: 2097152

# ============================================
# GitHub Integration
# ============================================
github:
  base-url: https://api.github.com
  token: ${GITHUB_TOKEN}
  api-version: ${GITHUB_API_VERSION:2022-11-28}

  connection:
    max-connections: 100
    pending-acquire-timeout: 45000
  timeout:
    connect: 5000
    read: 30000
    write: 30000
  memory:
    max-in-memory-size: 10485760

  webhook:
    secret: 80ef0e9ea4e139adb2616b89a736b2193474e595e4688e0bc38b40f68fe6032e
    batch:
      size: 10
      interval-ms: 5000

# ============================================
# FastAPI RAG Server
# ============================================
rag:
  base-url: ${RAG_SERVER_HOST}
  connection:
    max-connections: 100
    pending-acquire-timeout: 45000
  timeout:
    connect: 10000
    response: 60000
    read: 60000
    write: 60000
  memory:
    max-in-memory-size: 2097152

# ============================================
# (임시) OpenAI
# ============================================
openai:
  api:
    key: ${OPENAI_API_KEY}

# ============================================
# Custom App Config
# ============================================
app:
  frontend-domain: ${FRONTEND_DOMAIN:http://localhost:3000}
  base-url: ${SPRING_SERVER_BASE_URL:http://localhost:8080}
  oauth2:
    # 기본값은 로컬용, 배포 시 환경변수 OAUTH_REDIRECT_URI로 덮어쓰기
    redirect-uri: ${FRONTEND_DOMAIN}/oauth/callback
  daily-chat-limit: ${DAILY_CHAT_LIMIT}
